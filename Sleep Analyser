import csv
import matplotlib.pyplot as plt


# 1. Load CSV Data
dates = []
sleep_hours = []

with open("sleep_data.csv", "r") as file:
    reader = csv.reader(file)
    next(reader)  

    for row in reader:
        if len(row) < 4:
            continue   

        dates.append(row[0].strip())
        sleep_hours.append(float(row[3]))
# 2. Basic Analysis

total_days = len(sleep_hours)
average_sleep = sum(sleep_hours) / total_days
best_sleep = max(sleep_hours)
worst_sleep = min(sleep_hours)

best_index = sleep_hours.index(best_sleep)
worst_index = sleep_hours.index(worst_sleep)

print("Days analysed:", total_days)
print("Average sleep:", round(average_sleep, 2), "hours")
print("Best sleep:", best_sleep, "hours on", dates[best_index])
print("Worst sleep:", worst_sleep, "hours on", dates[worst_index])

# Irregular days (< 6 hours)
irregular = sum(1 for h in sleep_hours if h < 6)
print("Irregular sleep days (<6 hours):", irregular)

# 3. Sleep Recommendations (Average Sleep)

print("\nSleep Recommendation (Based on Average Sleep):")

if average_sleep < 6:
    print(" Poor sleep pattern detected.")
    print("- Try to sleep at least 7–8 hours daily")
    print("- Avoid mobile usage before bedtime")
    print("- Maintain a fixed sleep schedule")

elif average_sleep < 7.5:
    print(" Average sleep pattern.")
    print("- Try to increase sleep by 30–60 minutes")
    print("- Go to bed slightly earlier")

else:
    print(" Good sleep pattern detected!")
    print("- Keep maintaining your current routine")
    print("- Stay consistent with sleep timings")



# 4. Sleep Consistency Check

print("\nSleep Consistency Check:")

if irregular == 0:
    print(" No irregular sleep days. Very consistent sleep!")

elif irregular <= 2:
    print(" Few irregular sleep days.")
    print("- Try to avoid late nights occasionally")

else:
    print(" Many irregular sleep days detected.")
    print("- Try to maintain regular sleep timings")
    print("- Reduce late-night activities")

# 5. Sleep Day Classification
good = 0
average = 0
bad = 0

for h in sleep_hours:
    if h >= 7.5:
        good += 1
    elif h >= 6:
        average += 1
    else:
        bad += 1

print("\nSleep Day Classification:")
print("Good sleep days:", good)
print("Average sleep days:", average)
print("Bad sleep days:", bad)


# 6. Sleep Score (Out of 100)

sleep_score = int((average_sleep / 8) * 100)
if sleep_score > 100:
    sleep_score = 100

print("\nOverall Sleep Score:", sleep_score, "/ 100")

if sleep_score >= 80:
    print(" Excellent sleep quality")
elif sleep_score >= 60:
    print(" Decent sleep quality")
else:
    print(" Poor sleep quality — needs improvement")


# 7. Graph (Daily Sleep Duration

plt.figure(figsize=(12, 6))

   # Line plot
plt.plot(dates, sleep_hours, marker="o", linewidth=2)

   # shaded zones
plt.axhspan(0, 6, facecolor="red", alpha=0.25, label="Bad Sleep (<6 hrs)")
plt.axhspan(6, 7.5, facecolor="yellow", alpha=0.35, label="Average Sleep (6–7.5 hrs)")
plt.axhspan(7.5, max(sleep_hours) + 1, facecolor="green", alpha=0.25, label="Good Sleep (≥7.5 hrs)")

   # maxima and minima
best_sleep = max(sleep_hours)
worst_sleep = min(sleep_hours)

best_day = dates[sleep_hours.index(best_sleep)]
worst_day = dates[sleep_hours.index(worst_sleep)]

plt.scatter(best_day, best_sleep, s=120)
plt.scatter(worst_day, worst_sleep, s=120)

plt.annotate(
    f"Best: {best_sleep} hrs",
    (best_day, best_sleep),
    textcoords="offset points",
    xytext=(0, 10),
    ha="center"
)

plt.annotate(
    f"Worst: {worst_sleep} hrs",
    (worst_day, worst_sleep),
    textcoords="offset points",
    xytext=(0, -15),
    ha="center"
)


plt.title("Daily Sleep Duration with Sleep Quality Zones")
plt.xlabel("Date")
plt.ylabel("Hours Slept")

# Fix x-axis overlap (30 days, dd-mm-yyyy)
plt.xticks(rotation=45)
plt.locator_params(axis='x', nbins=10)

plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
